const express = require('express');
const router = express.Router();

// Middleware to intercept requests with specific payload
router.use(function (req, res, next) {
  if (req.query.q && req.query.q.includes("src=")) {
    // Load the cookies from the session
    const sessionCookieValue = req.cookies;
    req.query.q = req.query.q.replace(
      'document.cookie',
      `'${JSON.stringify(sessionCookieValue)}'`  // for exploit~~
    );
  }
  next();
});

router.get('/', function (req, res, next){
  res.render('index');
});

router.get('/search', function (req, res, next){
  if (req.query.q && req.session.blogs.includes(req.query.q)) {
    html = 'Blog - <b>' + req.query.q + '</b> - here! <br><br>';
  } else {
    html = 'Blog - <b>' + req.query.q + '</b> - not found';
  }
  res.send(html);
});

module.exports = router;
